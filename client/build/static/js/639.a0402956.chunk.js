/*! For license information please see 639.a0402956.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunksttlment_client=self.webpackChunksttlment_client||[]).push([[639],{8567(e,t,a){a.d(t,{E:()=>c});var s=a(22555),l=a(53986),n=(a(65043),a(10917)),i=a(15074),r=a(70579);const d=["className","variant"],o=(0,n.F)("inline-flex items-center rounded-lg border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-[#026174] text-white hover:bg-[#01505f]",secondary:"border-transparent bg-[#068294] text-white hover:bg-[#057a8a]",destructive:"border-transparent bg-[#ef4444] text-white hover:bg-[#dc2626]",outline:"border-[rgba(2,97,116,0.3)] bg-transparent text-[#026174]",success:"border-transparent bg-[#22c55e] text-white hover:bg-[#16a34a]",warning:"border-transparent bg-[#f59e0b] text-white hover:bg-[#d97706]",info:"border-transparent bg-[#026174] text-white hover:bg-[#01505f]"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:a}=e,n=(0,l.A)(e,d);return(0,r.jsx)("div",(0,s.A)({className:(0,i.cn)(o({variant:a}),t)},n))}},35087(e,t,a){a.d(t,{A:()=>s});const s=(0,a(21639).A)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},47810(e,t,a){a.d(t,{T:()=>o});var s=a(22555),l=a(53986),n=a(65043),i=a(15074),r=a(70579);const d=["className"],o=n.forwardRef((e,t)=>{let{className:a}=e,n=(0,l.A)(e,d);return(0,r.jsx)("textarea",(0,s.A)({className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all resize-none",a),ref:t},n))});o.displayName="Textarea"},50516(e,t,a){a.d(t,{A:()=>s});const s=(0,a(21639).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},61639(e,t,a){a.d(t,{TasksV2:()=>$});var s=a(22555),l=a(65043),n=a(63248),i=a(6931),r=a(73375),d=a(96938),o=a(69772),c=a(49954),u=a(8567),m=a(72147),x=a(70492),p=a(47810),h=a(47097),g=a(19162),b=a(51704);const v=(0,a(4548).vt)(e=>({dailyTasks:[],adHocTasks:[],setDailyTasks:t=>e({dailyTasks:t}),setAdHocTasks:t=>e({adHocTasks:t}),addTask:t=>e(e=>"daily"===t.type?{dailyTasks:[...e.dailyTasks,t]}:{adHocTasks:[...e.adHocTasks,t]}),updateTask:(t,a)=>e(e=>({dailyTasks:e.dailyTasks.map(e=>e.id===t?(0,s.A)((0,s.A)({},e),a):e),adHocTasks:e.adHocTasks.map(e=>e.id===t?(0,s.A)((0,s.A)({},e),a):e)})),removeTask:(t,a)=>e(e=>"daily"===a?{dailyTasks:e.dailyTasks.filter(e=>e.id!==t)}:{adHocTasks:e.adHocTasks.filter(e=>e.id!==t)})}));var y=a(2240),f=a(25851),j=a(60271),N=a(41680),w=a(35087),k=a(21888),_=a(9855),A=a(95919),T=a(66709),S=a(50516),C=a(71360),E=a(75088),L=a(35613),M=a(38298),P=a(39292),D=a(28646),I=a(34348),q=a.n(I),H=a(95773),F=a(50490),O=a(70579);function Y(e){let{show:t,onComplete:a,duration:s=2400,subtitle:n="\u062a\u0633\u0648\u064a\u0629 \u0645\u0637\u0627\u0628\u0642\u0629"}=e;const[i,o]=(0,l.useState)(t),[c,u]=(0,l.useState)(0);return(0,l.useEffect)(()=>{if(o(t),u(0),!t)return;const e=Date.now(),l=setInterval(()=>{const t=Date.now()-e;u(Math.min(t/s*100,100))},50),n=setTimeout(()=>{clearInterval(l),o(!1),null===a||void 0===a||a()},s);return()=>{clearTimeout(n),clearInterval(l)}},[t,s,a]),(0,O.jsx)(d.N,{children:i&&(0,O.jsxs)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-[100] flex items-center justify-center backdrop-blur-md",style:{background:"rgba(42, 110, 133, 0.35)"},"aria-hidden":"true",children:[(0,O.jsx)(r.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1.2,opacity:.15},exit:{scale:1,opacity:0},transition:{duration:.5},className:"absolute w-72 h-72 rounded-full border-4 border-emerald-400"}),(0,O.jsx)(r.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1.1,opacity:.1},exit:{scale:1,opacity:0},transition:{duration:.5,delay:.1},className:"absolute w-64 h-64 rounded-full border-4 border-[#068294]"}),(0,O.jsxs)(r.P.div,{initial:{scale:.5,opacity:0,rotate:-12},animate:{scale:1,opacity:1,rotate:0},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:280,damping:22},className:"relative flex flex-col items-center justify-center",children:[(0,O.jsxs)(r.P.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",stiffness:300,damping:18,delay:.1},className:"relative",children:[(0,O.jsx)("img",{src:"/stamp-settlement-reconciliation.png",alt:"\u062e\u062a\u0645 \u0627\u0644\u062a\u0633\u0648\u064a\u0629",className:"w-44 h-44 sm:w-52 sm:h-52 object-contain",style:{filter:"drop-shadow(0 10px 32px rgba(0,0,0,0.35)) drop-shadow(0 0 0 1px rgba(255,255,255,0.1))"}}),(0,O.jsx)(r.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.25,type:"spring",stiffness:400,damping:15},className:"absolute -bottom-1 -right-1 w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center shadow-lg","aria-hidden":!0,children:(0,O.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:(0,O.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})})]}),(0,O.jsx)(r.P.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.35},className:"mt-4 text-xl font-bold text-white drop-shadow-lg",children:n}),(0,O.jsx)(r.P.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.45},className:"mt-1 text-sm text-white/80",children:"\u062a\u0645 \u062d\u0641\u0638 \u0627\u0644\u062a\u0646\u0641\u064a\u0630 \u0628\u0646\u062c\u0627\u062d"}),(0,O.jsx)("div",{className:"mt-6 w-48 h-1 rounded-full bg-white/20 overflow-hidden",children:(0,O.jsx)(r.P.div,{className:"h-full rounded-full bg-emerald-400",initial:{width:0},animate:{width:"".concat(c,"%")},transition:{duration:.05}})})]})]})})}const K="#068294";function Q(e){let{label:t,value:a,multiline:s}=e;return(0,O.jsxs)("div",{className:"flex justify-between items-start gap-4 p-3 rounded-xl border bg-white",style:{borderColor:"rgba(6, 130, 148, 0.2)",background:"rgba(255,255,255,0.95)"},children:[(0,O.jsxs)("span",{className:"font-medium shrink-0",style:{color:"#068294"},children:[t,":"]}),(0,O.jsx)("span",{className:s?"text-end whitespace-pre-wrap break-words flex-1":"font-semibold",style:{color:K},children:a})]})}function z(e){let{message:t}=e;return(0,O.jsxs)("div",{className:"rounded-2xl p-16 text-center",style:{background:"var(--surface)",boxShadow:"var(--shadow-card)",border:"1px solid var(--border)"},children:[(0,O.jsx)("div",{className:"w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center",style:{background:"rgba(8, 131, 149, 0.08)"},children:(0,O.jsx)(N.A,{className:"w-8 h-8",style:{color:"var(--primary-600)"}})}),(0,O.jsx)("p",{className:"text-lg font-bold m-0",style:{color:"var(--text-strong)"},children:t})]})}function V(e){let{task:t,index:a,type:s,getStatusBadge:l,onDetails:n,onExecute:i,onDelete:d,canExecute:o,canDelete:c}=e;const u={completed:{bg:"rgba(22, 163, 74, 0.12)",bar:"linear-gradient(180deg, #16a34a, #22c55e)"},pending:{bg:"rgba(245, 158, 11, 0.12)",bar:"linear-gradient(180deg, #d97706, #f59e0b)"},overdue:{bg:"rgba(220, 38, 38, 0.12)",bar:"linear-gradient(180deg, #b91c1c, #dc2626)"}}[t.status]||{bg:"rgba(100, 116, 139, 0.12)",bar:"linear-gradient(180deg, var(--primary-800), var(--primary-600))"},m=t.template_title||t.title||"";return(0,O.jsxs)(r.P.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,scale:.98},whileHover:{scale:1.15,y:-8,zIndex:20,boxShadow:"0 28px 56px rgba(2, 97, 116, 0.2), 0 0 0 1px rgba(8, 131, 149, 0.3)",transition:{duration:.3,ease:[.25,.46,.45,.94]}},transition:{duration:.25,delay:.03*a,ease:[.25,.46,.45,.94]},className:"group relative flex flex-col rounded-2xl overflow-hidden cursor-pointer",style:{background:"var(--surface)",border:"2px solid var(--border-card)",boxShadow:"0 2px 8px rgba(15, 23, 42, 0.06), inset 0 1px 0 rgba(255,255,255,0.8)"},children:[(0,O.jsx)("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 pointer-events-none overflow-hidden rounded-2xl card-shine-hover"}),(0,O.jsx)("div",{className:"absolute top-0 bottom-0 w-1 rounded-r-full opacity-80 group-hover:opacity-100 group-hover:w-1.5 transition-all duration-300",style:{right:0,background:u.bar,boxShadow:"0 0 12px rgba(8, 131, 149, 0.3)"}}),(0,O.jsx)("div",{className:"absolute top-0 right-0 left-0 h-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{background:"linear-gradient(90deg, var(--primary-600), var(--primary-800))"}}),(0,O.jsxs)("div",{className:"p-5 pl-5 pr-6 flex flex-col flex-1",children:[(0,O.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,O.jsx)("h3",{className:"text-lg font-bold leading-snug line-clamp-2 flex-1 min-w-0",style:{color:"var(--text-strong)"},children:m}),l(t.status)]}),(0,O.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.category_name&&(0,O.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-sm font-medium",style:{background:"rgba(8, 131, 149, 0.08)",color:"var(--primary-800)"},children:[(0,O.jsx)(N.A,{className:"w-3.5 h-3.5"}),t.category_name]}),t.target_settlement_date&&(0,O.jsxs)("span",{className:"px-2.5 py-1 rounded-lg text-xs font-mono bg-slate-100 text-slate-600",dir:"ltr",children:["\u062a\u0633\u0648\u064a\u0629 ",String(t.target_settlement_date).slice(0,10)]}),(0,O.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{background:u.bg,color:"daily"===s?"var(--primary-800)":"#7c3aed"},children:"daily"===s?"\u064a\u0648\u0645\u064a\u0629":"\u062e\u0627\u0635\u0629"})]}),(0,O.jsxs)("div",{className:"space-y-2 text-sm flex-1 mb-4",children:[t.assigned_to_name&&(0,O.jsxs)("div",{className:"flex justify-between items-center p-2 rounded-lg",style:{background:"rgba(6, 130, 148, 0.06)"},children:[(0,O.jsx)("span",{className:"font-medium",style:{color:"var(--text-muted)"},children:"\u0627\u0644\u0645\u0633\u0624\u0648\u0644:"}),(0,O.jsx)("span",{className:"font-semibold",style:{color:"var(--primary-800)"},children:t.assigned_to_name})]}),t.created_by_name&&"ad-hoc"===s&&(0,O.jsxs)("div",{className:"flex justify-between items-center p-2 rounded-lg",style:{background:"rgba(6, 130, 148, 0.06)"},children:[(0,O.jsx)("span",{className:"font-medium",style:{color:"var(--text-muted)"},children:"\u0623\u0646\u0634\u0623\u0647\u0627:"}),(0,O.jsx)("span",{className:"font-semibold",style:{color:"var(--primary-800)"},children:t.created_by_name})]}),t.task_date&&(0,O.jsxs)("div",{className:"flex justify-between items-center p-2 rounded-lg",style:{background:"rgba(6, 130, 148, 0.06)"},children:[(0,O.jsx)("span",{className:"font-medium",style:{color:"var(--text-muted)"},children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e:"}),(0,O.jsx)("span",{className:"font-semibold",dir:"ltr",children:q()(t.task_date).format("YYYY-MM-DD")})]})]}),(0,O.jsxs)("div",{className:"flex gap-2 pt-4 mt-auto border-t",style:{borderColor:"var(--border)"},children:[(0,O.jsxs)(r.P.button,{type:"button",onClick:e=>{e.stopPropagation(),n()},className:"ds-btn ds-btn-outline flex-1 flex items-center justify-center gap-2 text-sm",whileHover:{scale:1.03},whileTap:{scale:.98},children:[(0,O.jsx)(w.A,{className:"w-4 h-4"}),"\u062a\u0641\u0627\u0635\u064a\u0644"]}),"completed"!==t.status&&o&&(0,O.jsxs)(r.P.button,{type:"button",onClick:e=>{e.stopPropagation(),i()},className:"ds-btn ds-btn-primary flex-1 flex items-center justify-center gap-2 text-sm",whileHover:{scale:1.03},whileTap:{scale:.98},children:[(0,O.jsx)(k.A,{className:"w-4 h-4"}),"\u062a\u0646\u0641\u064a\u0630"]}),c&&d&&(0,O.jsxs)(r.P.button,{type:"button",onClick:e=>{e.stopPropagation(),d()},className:"ds-btn flex items-center justify-center gap-2 text-sm px-3 py-2 rounded-lg text-white hover:opacity-90",style:{background:"var(--color-danger, #dc2626)"},whileHover:{scale:1.03},whileTap:{scale:.98},title:"\u062d\u0630\u0641 \u0627\u0644\u0645\u0647\u0645\u0629",children:[(0,O.jsx)(_.A,{className:"w-4 h-4"}),"\u062d\u0630\u0641"]})]})]})]})}function $(){var e;const{user:t}=(0,y.n)(),{toast:a}=(0,b.dj)(),[r,I]=(0,l.useState)(""),[$,Z]=(0,l.useState)(""),[B,G]=(0,l.useState)("single"),[R,U]=(0,l.useState)(q()().tz("Asia/Baghdad").format("YYYY-MM-DD")),[W,J]=(0,l.useState)(""),[X,ee]=(0,l.useState)(""),[te,ae]=(0,l.useState)(""),[se,le]=(0,l.useState)("cards"),[ne,ie]=(0,l.useState)("all"),[re,de]=(0,l.useState)(!1),[oe,ce]=(0,l.useState)(!1),[ue,me]=(0,l.useState)(!1),[xe,pe]=(0,l.useState)(null),[he,ge]=(0,l.useState)(null),[be,ve]=(0,l.useState)({resultStatus:"completed",notes:"",durationMinutes:"",settlement_date:"",settlement_value:""}),[ye,fe]=(0,l.useState)(""),[je,Ne]=(0,l.useState)(!1),we=(0,f.T)("tasks","filter_by_assignee"),ke=(0,f.T)("tasks","execute"),_e=(0,f.T)("tasks","create_ad_hoc"),Ae=(0,f.T)("tasks","view"),Te=(0,f.T)("tasks","delete_task"),[Se,Ce]=(0,l.useState)(null),[Ee,Le]=(0,l.useState)(!1),[Me,Pe]=(0,l.useState)(!1),[De,Ie]=(0,l.useState)(!1),qe=(0,n.jE)(),He=(0,s.A)((0,s.A)((0,s.A)((0,s.A)({},"single"===B&&R?{date:R}:{}),"range"===B&&W&&X?{dateFrom:W,dateTo:X}:{}),$?{view:$}:{}),we&&te?{assignedTo:te}:{}),Fe=(0,s.A)((0,s.A)((0,s.A)({},"range"===B&&W&&X?{dateFrom:W,dateTo:X}:{}),$?{view:$}:{}),we&&te?{assignedTo:te}:{}),{data:Oe=[],isLoading:Ye,refetch:Ke}=function(e){(0,n.jE)();const{setDailyTasks:t}=v();return(0,i.I)({queryKey:["daily-tasks",e],queryFn:async()=>{const a=new URLSearchParams;null!==e&&void 0!==e&&e.date&&a.append("date",e.date),null!==e&&void 0!==e&&e.dateFrom&&a.append("dateFrom",e.dateFrom),null!==e&&void 0!==e&&e.dateTo&&a.append("dateTo",e.dateTo),null!==e&&void 0!==e&&e.view&&a.append("view",e.view),null!==e&&void 0!==e&&e.assignedTo&&a.append("assignedTo",e.assignedTo);const l=(await g.A.get("/tasks/daily?".concat(a.toString()))).data.map(e=>(0,s.A)((0,s.A)({},e),{},{type:"daily"}));return t(l),l}})}(He),{data:Qe=[],isLoading:ze}=function(e){(0,n.jE)();const{setAdHocTasks:t}=v();return(0,i.I)({queryKey:["ad-hoc-tasks",e],queryFn:async()=>{const a=new URLSearchParams;null!==e&&void 0!==e&&e.dateFrom&&a.append("dateFrom",e.dateFrom),null!==e&&void 0!==e&&e.dateTo&&a.append("dateTo",e.dateTo),null!==e&&void 0!==e&&e.view&&a.append("view",e.view),null!==e&&void 0!==e&&e.assignedTo&&a.append("assignedTo",e.assignedTo);const l=(await g.A.get("/tasks/ad-hoc?".concat(a.toString()))).data.map(e=>(0,s.A)((0,s.A)({},e),{},{type:"ad-hoc"}));return t(l),l}})}(Fe),Ve=function(){const e=(0,n.jE)(),{toast:t}=(0,b.dj)();return(0,h.n)({mutationFn:async e=>(await g.A.post("/tasks/execute",e)).data,onSuccess:a=>{e.invalidateQueries({queryKey:["daily-tasks"]}),e.invalidateQueries({queryKey:["ad-hoc-tasks"]}),"matched"===(null===a||void 0===a?void 0:a.verification_status)?t({title:"\u062a\u0633\u0648\u064a\u0629 \u0645\u0637\u0627\u0628\u0642\u0629",description:"\u062a\u0645 \u0627\u0644\u062a\u062d\u0642\u0642 \u0645\u0646 \u0642\u064a\u0645\u0629 \u0627\u0644\u062a\u0633\u0648\u064a\u0629 \u0645\u0639 \u0635\u0641\u062d\u0629 \u0627\u0644\u062a\u0633\u0648\u064a\u0627\u062a \u0627\u0644\u062d\u0643\u0648\u0645\u064a\u0629 \u0628\u0646\u062c\u0627\u062d.",variant:"success"}):t({title:"\u0646\u062c\u062d",description:"\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0647\u0645\u0629 \u0628\u0646\u062c\u0627\u062d",variant:"success"})},onError:e=>{var a,s,l,n;"SETTLEMENT_MISMATCH"!==(null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.code)&&t({title:"\u062e\u0637\u0623",description:(null===(l=e.response)||void 0===l||null===(n=l.data)||void 0===n?void 0:n.error)||e.message||"\u062d\u062f\u062b \u062e\u0637\u0623",variant:"destructive"})}})}(),$e=function(){const e=(0,n.jE)(),{toast:t}=(0,b.dj)();return(0,h.n)({mutationFn:async e=>(await g.A.post("/tasks/ad-hoc",e)).data,onSuccess:()=>{e.invalidateQueries({queryKey:["ad-hoc-tasks"]}),t({title:"\u0646\u062c\u062d",description:"\u062a\u0645 \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0645\u0647\u0645\u0629 \u0627\u0644\u062e\u0627\u0635\u0629 \u0628\u0646\u062c\u0627\u062d",variant:"success"})},onError:e=>{var a,s;t({title:"\u062e\u0637\u0623",description:(null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||"\u062d\u062f\u062b \u062e\u0637\u0623",variant:"destructive"})}})}(),Ze=function(){const e=(0,n.jE)(),{toast:t}=(0,b.dj)();return(0,h.n)({mutationFn:async()=>(await g.A.post("/tasks/generate-daily")).data,onSuccess:a=>{e.invalidateQueries({queryKey:["daily-tasks"]}),t({title:"\u0646\u062c\u062d",description:a.message||"\u062a\u0645 \u062a\u0648\u0644\u064a\u062f \u0627\u0644\u0645\u0647\u0627\u0645 \u0628\u0646\u062c\u0627\u062d",variant:"success"})},onError:e=>{var a,s;t({title:"\u062e\u0637\u0623",description:(null===(a=e.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||"\u062d\u062f\u062b \u062e\u0637\u0623",variant:"destructive"})}})}();(0,l.useEffect)(()=>{g.A.get("/tasks/ensure-daily").then(e=>{const t=e.data;(null===t||void 0===t?void 0:t.generated)>0&&qe.invalidateQueries({queryKey:["daily-tasks"]})}).catch(()=>{})},[qe]);const{data:Be=[]}=(0,i.I)({queryKey:["users"],queryFn:async()=>(await g.A.get("/users")).data}),{data:Ge=[]}=(0,i.I)({queryKey:["templates"],queryFn:async()=>(await g.A.get("/templates?active=true")).data}),Re=Ye||ze,Ue=e=>[...e].sort((e,t)=>{const a="completed"!==e.status,s="completed"!==t.status;return a&&!s?-1:!a&&s?1:0}),We=e=>{if(!r.trim())return e;const t=r.toLowerCase().trim();return e.filter(e=>{const a=(e.template_title||e.title||"").toLowerCase(),s=(e.category_name||"").toLowerCase(),l=(e.assigned_to_name||"").toLowerCase(),n=(e.created_by_name||"").toLowerCase();return a.includes(t)||s.includes(t)||l.includes(t)||n.includes(t)})},Je=(0,l.useMemo)(()=>We(Ue(Oe)),[Oe,r]),Xe=(0,l.useMemo)(()=>We(Ue(Qe)),[Qe,r]),et="all"===ne||"daily_only"===ne,tt="all"===ne||"ad_hoc_only"===ne,at={total:Oe.length+Qe.length,pending:[...Oe,...Qe].filter(e=>"pending"===e.status||"overdue"===e.status).length,completed:[...Oe,...Qe].filter(e=>"completed"===e.status).length,overdue:Oe.filter(e=>"overdue"===e.status).length},st="daily"===(null===he||void 0===he?void 0:he.type)&&"government_settlement_bank"===(null===he||void 0===he||null===(e=he.template_required_fields)||void 0===e?void 0:e.category_type),lt=e=>{var t;ge((0,s.A)((0,s.A)({},e),{},{type:e.type||"daily"})),fe(""),"government_settlement_bank"===(null===(t=e.template_required_fields)||void 0===t?void 0:t.category_type)&&ve(t=>(0,s.A)((0,s.A)({},t),{},{settlement_date:e.target_settlement_date?String(e.target_settlement_date).slice(0,10):"",settlement_value:""})),de(!0)},nt=(e,t)=>Ce({id:e.id,type:t}),it=()=>Ce(null),rt=e=>{const t={completed:{variant:"success",label:"\u0645\u0643\u062a\u0645\u0644\u0629"},pending:{variant:"warning",label:"\u0645\u0639\u0644\u0642\u0629"},overdue:{variant:"destructive",label:"\u0645\u062a\u0623\u062e\u0631\u0629"},cancelled:{variant:"outline",label:"\u0645\u0644\u063a\u0627\u0629"},skipped:{variant:"outline",label:"\u062a\u062e\u0637\u064a"}}[e]||{variant:"default",label:e};return(0,O.jsx)(u.E,{variant:t.variant,children:t.label})};return(0,O.jsx)("div",{className:"min-h-screen",style:{padding:"1.5rem 2rem",background:"linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%)"},children:(0,O.jsxs)("div",{className:"mx-auto",style:{maxWidth:"1400px"},children:[(0,O.jsx)(Y,{show:je,onComplete:()=>{Ne(!1),de(!1),ge(null),ve({resultStatus:"completed",notes:"",durationMinutes:"",settlement_date:"",settlement_value:""})}}),(0,O.jsxs)("div",{className:"page-header-teal rounded-xl flex flex-wrap items-center justify-between gap-4 p-5 mb-6",style:{background:"linear-gradient(135deg, #026174 0%, #068294 100%)",color:"#ffffff",boxShadow:"0 10px 30px rgba(2, 97, 116, 0.35)"},children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("h1",{className:"text-2xl font-bold m-0 text-white",children:"\u0627\u0644\u0645\u0647\u0627\u0645"}),(0,O.jsx)("p",{className:"text-sm opacity-90 mt-1 m-0 text-white",children:"\u0625\u062f\u0627\u0631\u0629 \u0648\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0647\u0627\u0645 \u0627\u0644\u064a\u0648\u0645\u064a\u0629 \u0648\u0627\u0644\u062e\u0627\u0635\u0629"})]}),(0,O.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,O.jsxs)("div",{className:"flex rounded-full overflow-hidden border border-white/30 bg-white/10 p-0.5",children:[(0,O.jsxs)("button",{type:"button",onClick:()=>le("cards"),className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition-colors ".concat("cards"===se?"bg-white text-[#026174] shadow":"text-white/90 hover:bg-white/10"),children:[(0,O.jsx)(A.A,{className:"w-4 h-4"})," \u0643\u0631\u0648\u062a"]}),(0,O.jsxs)("button",{type:"button",onClick:()=>le("table"),className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition-colors ".concat("table"===se?"bg-white text-[#026174] shadow":"text-white/90 hover:bg-white/10"),children:[(0,O.jsx)(T.A,{className:"w-4 h-4"})," \u062c\u062f\u0648\u0644"]})]}),Ae&&(0,O.jsxs)("button",{type:"button",onClick:()=>Ze.mutate(),disabled:Ze.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium bg-white/20 hover:bg-white/30 transition-colors text-white disabled:opacity-50",children:[(0,O.jsx)(S.A,{className:"w-4 h-4 ".concat(Ze.isPending?"animate-spin":"")})," \u062a\u0648\u0644\u064a\u062f \u0627\u0644\u0645\u0647\u0627\u0645"]}),_e&&(0,O.jsxs)("button",{type:"button",onClick:()=>ce(!0),className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium bg-white text-[#026174] cursor-pointer hover:bg-white/95 transition-colors shadow",children:[(0,O.jsx)(C.A,{className:"w-4 h-4"})," \u0625\u0646\u0634\u0627\u0621 \u0645\u0646 \u0642\u0627\u0644\u0628"]}),Te&&(0,O.jsxs)("button",{type:"button",onClick:()=>Pe(!0),className:"flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium bg-red-600/90 hover:bg-red-600 text-white transition-colors shadow",title:"\u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0645\u0647\u0627\u0645",children:[(0,O.jsx)(_.A,{className:"w-4 h-4"})," \u062d\u0630\u0641 \u0627\u0644\u0643\u0644"]})]})]}),(0,O.jsx)(F.Q,{items:[{label:"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u0647\u0627\u0645",value:at.total,Icon:k.A,color:"#068294",glow:"rgba(6, 130, 148, 0.4)",gradient:"linear-gradient(135deg, #068294 0%, #026174 100%)"},{label:"\u0645\u0639\u0644\u0642\u0629",value:at.pending,Icon:E.A,color:"#f59e0b",glow:"rgba(245, 158, 11, 0.4)",gradient:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"},{label:"\u0645\u0643\u062a\u0645\u0644\u0629",value:at.completed,Icon:k.A,color:"#059669",glow:"rgba(5, 150, 105, 0.4)",gradient:"linear-gradient(135deg, #059669 0%, #047857 100%)"},{label:"\u0645\u062a\u0623\u062e\u0631\u0629",value:at.overdue,Icon:L.A,color:"#dc2626",glow:"rgba(220, 38, 38, 0.4)",gradient:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)"}]}),(0,O.jsxs)("div",{className:"rounded-2xl p-5 mb-6 border border-slate-200/80",style:{background:"linear-gradient(180deg, #ffffff 0%, #f8fafc 100%)",boxShadow:"0 4px 20px rgba(0,0,0,0.06)"},children:[(0,O.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,O.jsx)("div",{className:"p-1.5 rounded-lg bg-slate-100",children:(0,O.jsx)(M.A,{className:"w-4 h-4 text-slate-600"})}),(0,O.jsx)("span",{className:"text-base font-semibold text-slate-700",children:"\u0627\u0644\u0641\u0644\u0627\u062a\u0631 \u0648\u0627\u0644\u0628\u062d\u062b"})]}),(0,O.jsxs)("div",{className:"mb-4",children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0628\u062d\u062b \u0641\u064a \u0627\u0644\u0645\u0647\u0627\u0645"}),(0,O.jsxs)("div",{className:"relative",children:[(0,O.jsx)(P.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),(0,O.jsx)("input",{type:"text",placeholder:"\u0627\u0628\u062d\u062b \u0639\u0646 \u0623\u064a \u0645\u0647\u0645\u0629 (\u0639\u0646\u0648\u0627\u0646\u060c \u0641\u0626\u0629\u060c \u0645\u0633\u0624\u0648\u0644...)",value:r,onChange:e=>I(e.target.value),className:"w-full pr-10 px-3 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-[#068294]/30 focus:border-[#068294] bg-white text-slate-800"})]}),(0,O.jsx)("p",{className:"text-xs mt-1.5 text-slate-500",children:"\u064a\u0645\u0643\u0646\u0643 \u0627\u0644\u0628\u062d\u062b \u0639\u0646 \u0623\u064a \u0645\u0647\u0645\u0629 \u0648\u0625\u0646\u062c\u0627\u0632\u0647\u0627 \u062d\u062a\u0649 \u0644\u0648 \u0644\u0645 \u062a\u0643\u0646 \u0645\u062e\u0635\u0635\u0629 \u0644\u0643"})]}),(0,O.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0646\u0648\u0639 \u0627\u0644\u0645\u0647\u0627\u0645"}),(0,O.jsx)(m.Z,{value:ne,onChange:e=>ie(e),options:[{value:"all",label:"\u0627\u0644\u0643\u0644 (\u0627\u0644\u064a\u0648\u0645\u064a\u0629 + \u0627\u0644\u062e\u0627\u0635\u0629)"},{value:"daily_only",label:"\u0627\u0644\u064a\u0648\u0645\u064a\u0629 \u0641\u0642\u0637"},{value:"ad_hoc_only",label:"\u0627\u0644\u062e\u0627\u0635\u0629 \u0641\u0642\u0637"}],getOptionLabel:e=>e.label,getOptionValue:e=>e.value,placeholder:"\u0627\u0644\u0643\u0644",searchPlaceholder:"\u0627\u0628\u062d\u062b..."})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0639\u0631\u0636 \u0627\u0644\u0645\u0647\u0627\u0645"}),(0,O.jsx)(m.Z,{value:$,onChange:Z,options:[{value:"",label:"\u0627\u0644\u0643\u0644"},{value:"department_pending",label:"\u0645\u0647\u0627\u0645 \u0627\u0644\u0642\u0633\u0645 \u0627\u0644\u0645\u0639\u0644\u0642\u0629"},{value:"department_completed",label:"\u0645\u0647\u0627\u0645 \u0627\u0644\u0642\u0633\u0645 \u0627\u0644\u0645\u0646\u062c\u0632\u0629"},{value:"my_pending",label:"\u0645\u0647\u0627\u0645 \u0627\u0644\u0645\u0639\u0644\u0642\u0629 \u0645\u0646 \u0642\u0628\u0644\u064a"}],getOptionLabel:e=>e.label,getOptionValue:e=>e.value,placeholder:"\u0627\u0644\u0643\u0644",searchPlaceholder:"\u0627\u0628\u062d\u062b..."})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,O.jsx)(m.Z,{value:B,onChange:e=>G(e),options:[{value:"all",label:"\u0639\u0627\u0645 (\u0643\u0644 \u0627\u0644\u0641\u062a\u0631\u0627\u062a)"},{value:"single",label:"\u064a\u0648\u0645 \u0645\u062d\u062f\u062f"},{value:"range",label:"\u0641\u062a\u0631\u0629 \u0645\u0639\u064a\u0646\u0629"}],getOptionLabel:e=>e.label,getOptionValue:e=>e.value,placeholder:"\u0627\u062e\u062a\u0631 \u0648\u0636\u0639 \u0627\u0644\u062a\u0627\u0631\u064a\u062e",searchPlaceholder:"\u0627\u0628\u062d\u062b..."})]}),"single"===B&&(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0627\u0644\u064a\u0648\u0645"}),(0,O.jsx)(c.p,{type:"date",value:R,onChange:e=>U(e.target.value),className:"border border-slate-200 rounded-lg"})]}),"range"===B&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0645\u0646"}),(0,O.jsx)(c.p,{type:"date",value:W,onChange:e=>J(e.target.value),className:"border border-slate-200 rounded-lg"})]}),(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0625\u0644\u0649"}),(0,O.jsx)(c.p,{type:"date",value:X,onChange:e=>ee(e.target.value),className:"border border-slate-200 rounded-lg"})]})]}),we&&(0,O.jsxs)("div",{children:[(0,O.jsx)("label",{className:"block text-xs font-medium text-slate-500 mb-1",children:"\u0627\u0644\u0645\u0633\u0624\u0648\u0644"}),(0,O.jsx)(m.Z,{value:te,onChange:ae,options:[{value:"",label:"\u0627\u0644\u0643\u0644"},...Be.map(e=>({value:e.id.toString(),label:e.name}))],getOptionLabel:e=>e.label,getOptionValue:e=>e.value,placeholder:"\u0627\u0644\u0643\u0644",searchPlaceholder:"\u0627\u0628\u062d\u062b \u0639\u0646 \u0645\u0633\u062a\u062e\u062f\u0645..."})]})]})]}),Re?(0,O.jsx)("div",{className:"rounded-2xl p-16 flex justify-center",style:{background:"var(--surface)",boxShadow:"var(--shadow-card)",border:"1px solid var(--border)"},children:(0,O.jsxs)("div",{className:"animate-pulse flex flex-col items-center gap-4",children:[(0,O.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-slate-100"}),(0,O.jsx)("p",{className:"text-sm font-medium",style:{color:"var(--text-muted)"},children:"\u062c\u0627\u0631\u064a \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0647\u0627\u0645..."})]})}):"table"===se?(0,O.jsx)("div",{className:"overflow-x-auto",children:(0,O.jsxs)("table",{className:"ds-table w-full",children:[(0,O.jsx)("thead",{children:(0,O.jsxs)("tr",{className:"table-header-dark",style:{background:"linear-gradient(135deg, #026174 0%, #068294 100%)"},children:[(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0627\u0644\u0645\u0647\u0645\u0629"}),(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0627\u0644\u0646\u0648\u0639"}),(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0627\u0644\u0641\u0626\u0629"}),(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0627\u0644\u062d\u0627\u0644\u0629"}),(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e"}),(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0627\u0644\u0645\u0633\u0624\u0648\u0644"}),(0,O.jsx)("th",{className:"text-end py-4 px-4 font-bold text-white",children:"\u0625\u062c\u0631\u0627\u0621\u0627\u062a"})]})}),(0,O.jsx)("tbody",{children:[...et?Je.map(e=>(0,s.A)((0,s.A)({},e),{},{_rowType:"daily"})):[],...tt?Xe.map(e=>(0,s.A)((0,s.A)({},e),{},{_rowType:"ad-hoc"})):[]].map(e=>(0,O.jsxs)("tr",{children:[(0,O.jsx)("td",{className:"py-3 px-4 font-medium",style:{color:"var(--text-strong)"},children:e.template_title||e.title}),(0,O.jsx)("td",{className:"py-3 px-4",children:(0,O.jsx)("span",{className:"px-2 py-0.5 rounded text-xs font-medium",style:{background:"ad-hoc"===e._rowType?"rgba(124, 58, 237, 0.12)":"rgba(6, 130, 148, 0.12)",color:"ad-hoc"===e._rowType?"#7c3aed":"var(--primary-800)"},children:"ad-hoc"===e._rowType?"\u062e\u0627\u0635\u0629":"\u064a\u0648\u0645\u064a\u0629"})}),(0,O.jsx)("td",{className:"py-3 px-4",style:{color:"var(--text)"},children:e.category_name||"\u2014"}),(0,O.jsx)("td",{className:"py-3 px-4",children:rt(e.status)}),(0,O.jsx)("td",{className:"py-3 px-4",style:{color:"var(--text)"},dir:"ltr",children:e.task_date?q()(e.task_date).format("YYYY-MM-DD"):"\u2014"}),(0,O.jsx)("td",{className:"py-3 px-4",style:{color:"var(--text)"},children:e.assigned_to_name||e.created_by_name||"\u2014"}),(0,O.jsx)("td",{className:"py-3 px-4",children:(0,O.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[(0,O.jsxs)("button",{type:"button",onClick:()=>{pe((0,s.A)((0,s.A)({},e),{},{type:e._rowType})),me(!0)},className:"ds-btn ds-btn-outline flex items-center gap-1.5 px-3 py-1.5 text-sm",children:[(0,O.jsx)(w.A,{className:"w-3.5 h-3.5"})," \u062a\u0641\u0627\u0635\u064a\u0644"]}),"completed"!==e.status&&ke&&(0,O.jsxs)("button",{type:"button",onClick:()=>lt((0,s.A)((0,s.A)({},e),{},{type:e._rowType})),className:"ds-btn ds-btn-primary flex items-center gap-1.5 px-3 py-1.5 text-sm",children:[(0,O.jsx)(k.A,{className:"w-3.5 h-3.5"})," \u062a\u0646\u0641\u064a\u0630"]}),Te&&(0,O.jsxs)("button",{type:"button",onClick:()=>nt(e,e._rowType),className:"ds-btn flex items-center gap-1.5 px-3 py-1.5 text-sm text-white rounded-lg hover:opacity-90",style:{background:"#dc2626"},title:"\u062d\u0630\u0641",children:[(0,O.jsx)(_.A,{className:"w-3.5 h-3.5"})," \u062d\u0630\u0641"]})]})})]},"".concat(e._rowType,"-").concat(e.id)))})]})}):(0,O.jsxs)("div",{className:"space-y-8",children:[et&&(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,O.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",style:{color:"var(--primary-800)"},children:[(0,O.jsx)(D.A,{className:"h-5 w-5"}),"\u0627\u0644\u0645\u0647\u0627\u0645 \u0627\u0644\u064a\u0648\u0645\u064a\u0629 \u0627\u0644\u0645\u062c\u062f\u0648\u0644\u0629",(0,O.jsx)("span",{className:"px-2.5 py-0.5 rounded-lg text-sm font-bold",style:{background:"rgba(6, 130, 148, 0.12)",color:"var(--primary-800)"},children:Je.length})]})}),(0,O.jsx)("div",{className:"grid gap-5 sm:grid-cols-2 xl:grid-cols-3",children:(0,O.jsx)(d.N,{children:Je.map((e,t)=>(0,O.jsx)(V,{task:e,index:t,type:"daily",getStatusBadge:rt,onDetails:()=>{pe((0,s.A)((0,s.A)({},e),{},{type:"daily"})),me(!0)},onExecute:()=>lt((0,s.A)((0,s.A)({},e),{},{type:"daily"})),onDelete:Te?()=>nt(e,"daily"):void 0,canExecute:ke,canDelete:Te},"daily-".concat(e.id)))})}),0===Je.length&&(0,O.jsx)(z,{message:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0647\u0627\u0645 \u0645\u062c\u062f\u0648\u0644\u0629"})]}),tt&&(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,O.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",style:{color:"var(--primary-800)"},children:[(0,O.jsx)(N.A,{className:"h-5 w-5"}),"\u0627\u0644\u0645\u0647\u0627\u0645 \u0627\u0644\u062e\u0627\u0635\u0629",(0,O.jsx)("span",{className:"px-2.5 py-0.5 rounded-lg text-sm font-bold",style:{background:"rgba(6, 130, 148, 0.12)",color:"var(--primary-800)"},children:Xe.length})]})}),(0,O.jsx)("div",{className:"grid gap-5 sm:grid-cols-2 xl:grid-cols-3",children:(0,O.jsx)(d.N,{children:Xe.map((e,t)=>(0,O.jsx)(V,{task:e,index:t,type:"ad-hoc",getStatusBadge:rt,onDetails:()=>{pe((0,s.A)((0,s.A)({},e),{},{type:"ad-hoc"})),me(!0)},onExecute:()=>{ge((0,s.A)((0,s.A)({},e),{},{type:"ad-hoc"})),de(!0)},onDelete:Te?()=>nt(e,"ad-hoc"):void 0,canExecute:ke,canDelete:Te},"ad-hoc-".concat(e.id)))})}),0===Xe.length&&(0,O.jsx)(z,{message:"\u0644\u0627 \u062a\u0648\u062c\u062f \u0645\u0647\u0627\u0645 \u062e\u0627\u0635\u0629"})]})]}),(0,O.jsx)(x.lG,{open:!!Se,onOpenChange:e=>!e&&!Ee&&it(),children:(0,O.jsxs)(x.Cf,{className:"max-w-sm rounded-2xl",children:[(0,O.jsx)(x.c7,{children:(0,O.jsx)(x.L3,{className:"text-lg font-bold",children:"\u062d\u0630\u0641 \u0627\u0644\u0645\u0647\u0645\u0629"})}),(0,O.jsx)("p",{className:"text-sm text-slate-600",children:"\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0647\u0645\u0629\u061f \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621."}),(0,O.jsxs)(x.Es,{className:"gap-2 pt-4",children:[(0,O.jsx)(o.$,{type:"button",variant:"outline",onClick:it,disabled:Ee,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,O.jsx)(o.$,{type:"button",onClick:async()=>{if(Se)try{Le(!0);const e="daily"===Se.type?"daily":"ad-hoc";await g.A.delete("/tasks/".concat(e,"/").concat(Se.id)),a({title:"\u062a\u0645",description:"\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0645\u0647\u0645\u0629"}),Ce(null),await Promise.all([qe.invalidateQueries({queryKey:["daily-tasks"]}),qe.invalidateQueries({queryKey:["ad-hoc-tasks"]})])}catch(s){var e,t;a({title:"\u062e\u0637\u0623",description:(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error)||"\u0641\u0634\u0644 \u062d\u0630\u0641 \u0627\u0644\u0645\u0647\u0645\u0629",variant:"destructive"})}finally{Le(!1)}},disabled:Ee,className:"bg-red-600 hover:bg-red-700 text-white",children:Ee?"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0630\u0641...":"\u062d\u0630\u0641"})]})]})}),(0,O.jsx)(x.lG,{open:Me,onOpenChange:e=>!e&&!De&&Pe(!1),children:(0,O.jsxs)(x.Cf,{className:"max-w-sm rounded-2xl",children:[(0,O.jsx)(x.c7,{children:(0,O.jsx)(x.L3,{className:"text-lg font-bold",children:"\u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0645\u0647\u0627\u0645"})}),(0,O.jsxs)("p",{className:"text-sm text-slate-600",children:["\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 ",(0,O.jsx)("strong",{children:"\u062c\u0645\u064a\u0639"})," \u0627\u0644\u0645\u0647\u0627\u0645 (\u0627\u0644\u064a\u0648\u0645\u064a\u0629 \u0648\u0627\u0644\u062e\u0627\u0635\u0629)\u061f \u0644\u0627 \u064a\u0645\u0643\u0646 \u0627\u0644\u062a\u0631\u0627\u062c\u0639 \u0639\u0646 \u0647\u0630\u0627 \u0627\u0644\u0625\u062c\u0631\u0627\u0621."]}),(0,O.jsxs)(x.Es,{className:"gap-2 pt-4",children:[(0,O.jsx)(o.$,{type:"button",variant:"outline",onClick:()=>Pe(!1),disabled:De,children:"\u0625\u0644\u063a\u0627\u0621"}),(0,O.jsx)(o.$,{type:"button",onClick:async()=>{try{var e;Ie(!0);const t=await g.A.delete("/tasks/all");a({title:"\u062a\u0645",description:(null===(e=t.data)||void 0===e?void 0:e.message)||"\u062a\u0645 \u062d\u0630\u0641 \u062c\u0645\u064a\u0639 \u0627\u0644\u0645\u0647\u0627\u0645"}),Pe(!1),await Promise.all([qe.invalidateQueries({queryKey:["daily-tasks"]}),qe.invalidateQueries({queryKey:["ad-hoc-tasks"]})])}catch(l){var t,s;a({title:"\u062e\u0637\u0623",description:(null===(t=l.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"\u0641\u0634\u0644 \u062d\u0630\u0641 \u0627\u0644\u0645\u0647\u0627\u0645",variant:"destructive"})}finally{Ie(!1)}},disabled:De,className:"bg-red-600 hover:bg-red-700 text-white",children:De?"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0630\u0641...":"\u062d\u0630\u0641 \u0627\u0644\u0643\u0644"})]})]})}),(0,O.jsx)(x.lG,{open:ue,onOpenChange:me,children:(0,O.jsxs)(x.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl",children:[(0,O.jsx)(x.c7,{children:(0,O.jsxs)(x.L3,{className:"text-2xl font-bold flex items-center gap-2",style:{color:K},children:[(0,O.jsx)(w.A,{className:"h-6 w-6"}),"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u0645\u0647\u0645\u0629"]})}),xe&&(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"p-4 rounded-xl bg-slate-50 border border-slate-200",children:[(0,O.jsx)("h3",{className:"text-lg font-bold mb-2 text-slate-800",children:xe.template_title||xe.title}),xe.category_name&&(0,O.jsx)(u.E,{variant:"outline",className:"rounded-lg",children:xe.category_name}),rt(xe.status)]}),(0,O.jsxs)("div",{className:"grid gap-3 text-sm",children:["daily"===xe.type&&xe.assigned_to_name&&(0,O.jsx)(Q,{label:"\u0627\u0644\u0645\u0633\u0624\u0648\u0644",value:xe.assigned_to_name}),xe.task_date&&(0,O.jsx)(Q,{label:"\u0627\u0644\u062a\u0627\u0631\u064a\u062e",value:q()(xe.task_date).format("YYYY-MM-DD")}),xe.due_date_time&&(0,O.jsx)(Q,{label:"\u0648\u0642\u062a \u0627\u0644\u0627\u0633\u062a\u062d\u0642\u0627\u0642",value:(0,j.cd)(xe.due_date_time)}),xe.description&&(0,O.jsx)(Q,{label:"\u0627\u0644\u0648\u0635\u0641",value:xe.description,multiline:!0}),"ad-hoc"===xe.type&&xe.created_by_name&&(0,O.jsx)(Q,{label:"\u0623\u0646\u0634\u0623\u0647\u0627",value:xe.created_by_name}),xe.beneficiary&&(0,O.jsx)(Q,{label:"\u0627\u0644\u062c\u0647\u0629 \u0627\u0644\u0645\u0633\u062a\u0641\u064a\u062f\u0629",value:xe.beneficiary}),xe.notes&&(0,O.jsx)(Q,{label:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a",value:xe.notes,multiline:!0})]}),"completed"!==xe.status&&ke&&(0,O.jsxs)(o.$,{className:"w-full rounded-xl text-white font-bold animate-pulse",style:{background:K,color:"#ffffff"},onClick:()=>{me(!1),lt(xe)},children:[(0,O.jsx)(k.A,{className:"h-4 w-4 ml-2"}),"\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0647\u0645\u0629"]})]})]})}),(0,O.jsx)(x.lG,{open:re,onOpenChange:e=>{de(e),e||fe("")},children:(0,O.jsxs)(x.Cf,{className:"max-w-2xl",children:[(0,O.jsx)(x.c7,{children:(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(H.v,{size:"sm",animated:!1}),(0,O.jsx)(x.L3,{className:"text-2xl font-bold",style:{color:K},children:"\u062a\u0646\u0641\u064a\u0630 \u0627\u0644\u0645\u0647\u0645\u0629"})]})}),(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"text-sm font-semibold",children:"\u062d\u0627\u0644\u0629 \u0627\u0644\u062a\u0646\u0641\u064a\u0630"}),(0,O.jsx)(m.Z,{value:be.resultStatus,onChange:e=>ve((0,s.A)((0,s.A)({},be),{},{resultStatus:e})),options:[{value:"completed",label:"\u0645\u0643\u062a\u0645\u0644\u0629 (\u0641\u064a \u0627\u0644\u0648\u0642\u062a)"},{value:"completed_late",label:"\u0645\u0643\u062a\u0645\u0644\u0629 (\u0645\u062a\u0623\u062e\u0631\u0629)"},{value:"skipped",label:"\u062a\u0645 \u0627\u0644\u062a\u062e\u0637\u064a"},{value:"cancelled",label:"\u0645\u0644\u063a\u0627\u0629"}],getOptionLabel:e=>e.label,getOptionValue:e=>e.value,placeholder:"\u0627\u062e\u062a\u0631 \u0627\u0644\u062d\u0627\u0644\u0629"})]}),st&&("completed"===be.resultStatus||"completed_late"===be.resultStatus)&&(0,O.jsxs)("div",{className:"space-y-3 rounded-xl border-2 p-4",style:{borderColor:"rgba(6, 130, 148, 0.25)",background:"rgba(255,255,255,0.9)"},children:[(0,O.jsx)("p",{className:"text-sm font-semibold",style:{color:"#2A6E85"},children:"\u062a\u0623\u0643\u064a\u062f \u0627\u0644\u062a\u0633\u0648\u064a\u0629 (\u0645\u0637\u0627\u0628\u0642\u0629 \u0645\u0639 \u0635\u0641\u062d\u0629 \u0627\u0644\u062a\u0633\u0648\u064a\u0627\u062a \u0627\u0644\u062d\u0643\u0648\u0645\u064a\u0629)"}),(0,O.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,O.jsxs)("div",{className:"space-y-1",children:[(0,O.jsx)("label",{className:"text-sm font-medium",children:"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0633\u0648\u064a\u0629 *"}),(0,O.jsx)(c.p,{type:"date",value:be.settlement_date,onChange:e=>ve((0,s.A)((0,s.A)({},be),{},{settlement_date:e.target.value})),className:"border-2"})]}),(0,O.jsxs)("div",{className:"space-y-1",children:[(0,O.jsx)("label",{className:"text-sm font-medium",children:"\u0642\u064a\u0645\u0629 \u0627\u0644\u062a\u0633\u0648\u064a\u0629 (STTLE) *"}),(0,O.jsx)(c.p,{type:"text",inputMode:"decimal",placeholder:"0.00",value:be.settlement_value,onChange:e=>ve((0,s.A)((0,s.A)({},be),{},{settlement_value:e.target.value})),className:"border-2 font-mono",dir:"ltr"})]})]}),(0,O.jsx)("p",{className:"text-xs",style:{color:"#068294"},children:"\u064a\u062a\u0645 \u0645\u0642\u0627\u0631\u0646\u0629 \u0627\u0644\u0642\u064a\u0645\u0629 \u0645\u0639 \u0645\u062c\u0645\u0648\u0639 STTLE \u0641\u064a \u0635\u0641\u062d\u0629 \u0627\u0644\u062a\u0633\u0648\u064a\u0627\u062a \u0627\u0644\u062d\u0643\u0648\u0645\u064a\u0629 \u062d\u0633\u0628 \u0627\u0644\u062a\u0627\u0631\u064a\u062e \u0648\u0627\u0644\u0645\u0635\u0631\u0641. \u0639\u0646\u062f \u0627\u0644\u062a\u0637\u0627\u0628\u0642 \u062a\u064f\u0642\u0628\u0644 \u0627\u0644\u0645\u0647\u0645\u0629 \u0648\u062a\u0638\u0647\u0631 \xab\u062a\u0633\u0648\u064a\u0629 \u0645\u0637\u0627\u0628\u0642\u0629\xbb."})]}),(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"text-sm font-semibold",children:"\u0645\u0644\u0627\u062d\u0638\u0627\u062a"}),(0,O.jsx)(p.T,{value:be.notes,onChange:e=>ve((0,s.A)((0,s.A)({},be),{},{notes:e.target.value})),rows:4,className:"border-2"})]}),(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"text-sm font-semibold",children:"\u0627\u0644\u0645\u062f\u0629 (\u062f\u0642\u064a\u0642\u0629) - \u0627\u062e\u062a\u064a\u0627\u0631\u064a"}),(0,O.jsx)(c.p,{type:"number",value:be.durationMinutes,onChange:e=>ve((0,s.A)((0,s.A)({},be),{},{durationMinutes:e.target.value})),min:"0",className:"border-2"})]}),ye&&(0,O.jsx)("div",{className:"rounded-xl border-2 border-red-200 bg-red-50 p-3 text-sm text-red-800",role:"alert",children:ye})]}),(0,O.jsxs)(x.Es,{className:"gap-2 pt-4 border-t border-slate-200",children:[(0,O.jsx)(o.$,{variant:"outline",onClick:()=>de(!1),className:"rounded-xl",children:"\u0625\u0644\u063a\u0627\u0621"}),(0,O.jsx)(o.$,{onClick:async()=>{if(he){var e,t;if(st&&("completed"===be.resultStatus||"completed_late"===be.resultStatus))if(null===(e=be.settlement_date)||void 0===e||!e.trim()||null===(t=be.settlement_value)||void 0===t||!t.trim())return void a({title:"\u062a\u0646\u0628\u064a\u0647",description:"\u0645\u0647\u0627\u0645 \u0627\u0644\u062a\u0633\u0648\u064a\u0629 \u0627\u0644\u062d\u0643\u0648\u0645\u064a\u0629 \u062a\u062a\u0637\u0644\u0628 \u062a\u0627\u0631\u064a\u062e \u0627\u0644\u062a\u0633\u0648\u064a\u0629 \u0648\u0642\u064a\u0645\u0629 \u0627\u0644\u062a\u0633\u0648\u064a\u0629",variant:"destructive"});fe("");try{const e="daily"===he.type?Number(he.id):void 0,t="ad-hoc"===he.type?Number(he.id):void 0;if("daily"===he.type&&(null==e||Number.isNaN(e))||"ad-hoc"===he.type&&(null==t||Number.isNaN(t)))return void fe("\u0645\u0639\u0631\u0641 \u0627\u0644\u0645\u0647\u0645\u0629 \u063a\u064a\u0631 \u0635\u0627\u0644\u062d. \u0623\u0639\u062f \u0641\u062a\u062d \u0627\u0644\u0635\u0641\u062d\u0629 \u0648\u062d\u0627\u0648\u0644 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649.");const a={dailyTaskId:"daily"===he.type?e:void 0,adHocTaskId:"ad-hoc"===he.type?t:void 0,resultStatus:be.resultStatus,notes:be.notes,durationMinutes:be.durationMinutes?parseInt(be.durationMinutes,10):void 0};if(st&&("completed"===be.resultStatus||"completed_late"===be.resultStatus)){var s,l,n,i;const e=(null===(s=be.settlement_date)||void 0===s?void 0:s.trim().slice(0,10))||"";a.settlement_date=e.includes("/")?e.replace(/\//g,"-"):e;const t=null!==(l=null===(n=be.settlement_value)||void 0===n||null===(i=n.replace)||void 0===i?void 0:i.call(n,/,/g,""))&&void 0!==l?l:be.settlement_value;a.settlement_value=""===t?void 0:t}await Ve.mutateAsync(a),Ne(!0)}catch(u){var r,d,o,c;const e=null===u||void 0===u||null===(r=u.response)||void 0===r?void 0:r.data,t=null===e||void 0===e?void 0:e.code,s=null!==(d=null!==(o=null!==(c=null===e||void 0===e?void 0:e.error)&&void 0!==c?c:null===e||void 0===e?void 0:e.message)&&void 0!==o?o:"string"===typeof e?e:null)&&void 0!==d?d:null!==u&&void 0!==u&&u.message&&"Network Error"!==u.message?u.message:"\u062d\u062f\u062b \u062e\u0637\u0623. \u062a\u062d\u0642\u0642 \u0645\u0646 \u0627\u0644\u0627\u062a\u0635\u0627\u0644 \u062b\u0645 \u0623\u0639\u062f \u0627\u0644\u0645\u062d\u0627\u0648\u0644\u0629.";if(fe(s+(null!=(null===e||void 0===e?void 0:e.expected_sum_sttle)?" (\u0627\u0644\u0645\u062a\u0648\u0642\u0639: ".concat(Number(e.expected_sum_sttle).toLocaleString("en-US"),")"):"")),"SETTLEMENT_MISMATCH"===t)return void a({title:"\u063a\u064a\u0631 \u0645\u0637\u0627\u0628\u0642\u0629",description:s+(null!=(null===e||void 0===e?void 0:e.expected_sum_sttle)?" (\u0627\u0644\u0645\u062a\u0648\u0642\u0639: ".concat(Number(e.expected_sum_sttle).toLocaleString("en-US"),")"):""),variant:"destructive"});a({title:"\u062e\u0637\u0623",description:s,variant:"destructive"})}}},disabled:Ve.isPending,className:"rounded-xl font-semibold",style:{background:"linear-gradient(135deg, #026174, #068294)",color:"#fff"},children:Ve.isPending?"\u062c\u0627\u0631\u064a \u0627\u0644\u062d\u0641\u0638...":"\u062d\u0641\u0638"})]})]})}),(0,O.jsx)(x.lG,{open:oe,onOpenChange:ce,children:(0,O.jsxs)(x.Cf,{className:"max-w-lg",children:[(0,O.jsxs)(x.c7,{children:[(0,O.jsxs)("div",{className:"flex items-center gap-3",children:[(0,O.jsx)(H.v,{size:"sm",animated:!1}),(0,O.jsx)(x.L3,{className:"text-xl text-slate-900",children:"\u0625\u0646\u0634\u0627\u0621 \u0645\u0647\u0645\u0629 \u0645\u0646 \u0642\u0627\u0644\u0628"})]}),(0,O.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"\u0627\u062e\u062a\u0631 \u0642\u0627\u0644\u0628\u064b\u0627 \u0644\u0625\u0646\u0634\u0627\u0621 \u0645\u0647\u0645\u0629 \u062e\u0627\u0635\u0629 \u0641\u0648\u0631\u064b\u0627."})]}),(0,O.jsx)("div",{className:"space-y-4",children:(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"\u0627\u062e\u062a\u0631 \u0642\u0627\u0644\u0628 \u0627\u0644\u0645\u0647\u0645\u0629 *"}),(0,O.jsx)(m.Z,{value:"",onChange:async e=>{const t=Ge.find(t=>t.id===parseInt(e));if(!t)return;const a=await $e.mutateAsync({templateId:parseInt(e),categoryId:t.category_id,title:t.title,description:t.description});ge((0,s.A)((0,s.A)({},a),{},{type:"ad-hoc"})),ce(!1),de(!0)},options:Ge,getOptionLabel:e=>e.title,getOptionValue:e=>e.id.toString(),placeholder:"\u2014 \u0627\u062e\u062a\u0631 \u0642\u0627\u0644\u0628 \u2014",searchPlaceholder:"\u0627\u0628\u062d\u062b \u0639\u0646 \u0642\u0627\u0644\u0628..."})]})}),(0,O.jsx)(x.Es,{className:"gap-2 pt-4 border-t border-slate-200",children:(0,O.jsx)(o.$,{variant:"outline",onClick:()=>ce(!1),className:"rounded-xl",children:"\u0625\u0644\u063a\u0627\u0621"})})]})})]})})}}}]);
//# sourceMappingURL=639.a0402956.chunk.js.map
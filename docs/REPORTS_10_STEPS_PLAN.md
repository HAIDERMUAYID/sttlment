# خطة التقارير الحقيقية — 10 خطوات

## الهدف
تقرير **حقيقي** يركز على: محصلات (تسويات حسب المصرف)، أعداد المهام حسب الفئة ومرة حسب القالب+الفئة، توزيع الموظفين، مع **رسوميات وصور الموظفين**. بدون قوائم الملفات المحملة وسجل التدقيق. **الأرقام بالإنجليزي** (1, 2, 3).

---

## الخطوة 1: تحديد مخرجات التقرير فقط
- **محصلات:** كل مصرف → عدد التسويات خلال الفترة (من gov_settlement_summaries أو details).
- **المهام حسب الفئة:** كل فئة → عدد المهام (مجدولة + إضافية).
- **المهام حسب القالب والفئة:** كل قالب مهمة + فئته → عدد المهام.
- **توزيع الموظفين:** كل موظف → أيام حضور، عدد مهام منجزة، في الوقت، متأخرة (ملخص + صورة/أفاتار).
- **لا نعرض:** قائمة ملفات الاستيراد، سجل التدقيق.

---

## الخطوة 2: Backend — API واحد مبسّط
- نقطة واحدة: `GET /api/reports/comprehensive` (أو اسم أوضح مثل `/api/reports/full`).
- الاستجابة تحتوي فقط:
  - **period, dateFrom, dateTo**
  - **settlementsByBank:** مصفوفة `{ bank_name, settlement_count }` (عدد التسويات خلال الفترة لكل مصرف).
  - **tasksByCategory:** مصفوفة `{ category_name, task_count }`.
  - **tasksByTemplateAndCategory:** مصفوفة `{ template_title, category_name, task_count }`.
  - **employees:** مصفوفة `{ id, name, avatar_url, attendance_days, tasks_done, on_time, late }`.
  - إزالة من الاستجابة: قائمة الاستيراد (imports)، سجل التدقيق (audit).

---

## الخطوة 3: عرض الأرقام بالإنجليزي
- في الواجهة: استخدام أرقام إنجليزية (0–9) وعدم استخدام `toLocaleString('ar-IQ')` الذي يعرض أرقاماً عربية.
- استخدام `toLocaleString('en')` أو عرض الرقم كما هو مع فواصل الآلاف بالإنجليزي.

---

## الخطوة 4: واجهة التقرير — الهيكل العام
- **أعلى:** عنوان التقرير + فلتر الفترة (يوم / أسبوع / شهر / مخصص) + تاريخ من–إلى.
- **قسم واحد للمحصلات:** عنوان "المحصلات — التسويات حسب المصرف" ثم رسومية + جدول مختصر.
- **قسم المهام حسب الفئة:** رسومية (دائري أو أعمدة) + جدول (فئة، عدد المهام) — أرقام إنجليزية.
- **قسم المهام حسب القالب والفئة:** جدول (قالب، فئة، عدد المهام) — أرقام إنجليزية.
- **قسم توزيع الموظفين:** صورة/أفاتار كل موظف + الاسم + أيام حضور، مهام منجزة، في الوقت، متأخرة — أرقام إنجليزية.
- لا أقسام لـ "ملفات محملة" أو "سجل التدقيق".

---

## الخطوة 5: رسومية المحصلات (تسويات حسب المصرف)
- رسم بياني أعمدة (Bar chart): المحور الأفقي = اسم المصرف، المحور العمودي = عدد التسويات.
- مصدر البيانات: تجميع من gov_settlement_summaries أو gov_settlement_details حسب المصرف (COUNT أو عدد الصفوف المميزة حسب تاريخ+مصرف).

---

## الخطوة 6: رسومية المهام حسب الفئة
- رسم دائري (Pie/Donut) أو أعمدة أفقية: كل فئة مع عدد المهام.
- مصدر البيانات: tasksByCategory من الـ API.

---

## الخطوة 7: جدول/رسومية المهام حسب القالب والفئة
- جدول واضح: عمود "القالب"، عمود "الفئة"، عمود "عدد المهام" (أرقام إنجليزية).
- اختياري: رسم أعمدة للقالب+الفئة إذا كانت العناصر ليست كثيرة.

---

## الخطوة 8: توزيع الموظفين مع الصور
- عرض كل موظف في كارت أو صف: **صورة الموظف (avatar_url)** + الاسم + أيام الحضور، عدد المهام المنجزة، في الوقت، متأخرة.
- الأرقام بالإنجليزي. إذا لم توجد صورة: عرض أحرف الاسم الأولى أو أيقونة افتراضية.

---

## الخطوة 9: تصميم بصري موحّد
- استخدام نظام الألوان الحالي (تيل/أزرق).
- بطاقات (Cards) للأقسام، عناوين واضحة، مسافات منظمة.
- إضافة مكتبة رسوم بيانية (مثلاً Recharts) إن لم تكن موجودة.

---

## الخطوة 10: الاختبار والمراجعة
- التأكد أن التقرير يعرض فقط: المحصلات حسب المصرف، المهام حسب الفئة، المهام حسب القالب+الفئة، توزيع الموظفين مع الصور.
- التأكد أن كل الأرقام بالإنجليزي.
- التأكد إزالة عرض الملفات المحملة وسجل التدقيق من الواجهة والـ API.

---

## ملخص الضمان
| المطلوب | التطبيق |
|---------|---------|
| محصلات | تسويات حسب المصرف (عدد التسويات خلال الفترة) |
| رسوميات | رسم أعمدة للمصارف، رسم للمهام حسب الفئة |
| صور الموظفين | أفاتار/صورة في قسم توزيع الموظفين |
| لا ملفات محملة | إزالة قائمة الاستيراد من التقرير |
| لا سجل تدقيق | إزالة سجل التدقيق من التقرير |
| كل مصرف كم تسوياته | settlementsByBank: bank_name + settlement_count |
| المهام حسب الفئة مرة | tasksByCategory |
| المهام حسب قالب+فئة مرة | tasksByTemplateAndCategory |
| توزيع الموظفين | employees مع صورة وملخص أرقام |
| أرقام إنجليزية | toLocaleString('en') أو عرض رقم إنجليزي فقط |

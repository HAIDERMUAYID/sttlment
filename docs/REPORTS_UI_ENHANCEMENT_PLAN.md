# خطة تطوير واجهة التقارير — واجهة مثالية مع رسوميات وصور وتجربة شاملة

## المبادئ

1. **عدم استخدام جدول `rtgs`** — الاعتماد بالكامل على **جدول تفاصيل التسويات الحكومية**:
   - `gov_settlement_summaries`: ملخص حسب تاريخ التسوية + مصرف (حركات، مبالغ، عمولات، تسوية).
   - `gov_settlement_details`: تفاصيل حسب تاجر/وزارة/مديرية/محافظة (للتحليلات والرسوميات).

2. **واجهة مثاليّة:** رسوميات، رسوم بيانية، صور/أيقونات، تدرجات لونية، تقدم بصري، وتجربة مستخدم حديثة.

3. **تطوير اشمل:** كل قسم من التقرير يُعاد تصوره كـ "لوحة مصغّرة" مع رسوم بيانية وقصص بصرية وليس جداول فقط.

---

## مصدر بيانات التسويات (بدون rtgs)

| المصدر | الاستخدام في التقرير |
|--------|------------------------|
| **gov_settlement_summaries** | إجمالي الحركات، إجمالي المبالغ (amount, fees, acq, sttle) للفترة؛ توزيع حسب تاريخ التسوية؛ توزيع حسب المصرف (bank_display_name). |
| **gov_settlement_details** | تفاصيل حسب وزارة/مديرية/محافظة؛ عدد التسويات (صفوف)؛ عينة أحدث التسويات؛ توزيع للتجارة أو الجهات. |
| **import_logs** | قائمة ملفات الاستيراد في الفترة (اختياري للسياق فقط — لا يُستخرج منه إحصائيات حركات أو مبالغ). |

لا يُستدعى جدول `rtgs` في أي استعلام في صفحة التقارير.

---

## هيكل الواجهة المثالية

### 1. الهيرو (أعلى الصفحة)

- **خلفية:** تدرج لوني هادئ (تيل/أزرق) أو صورة/شكل هندسي خفيف.
- **عنوان رئيسي:** "التقارير الشاملة — قسم التسويات والمطابقة".
- **عنوان فرعي:** الفترة المعروضة (من – إلى) بتنسيق واضح.
- **فلتر الفترة:** أزرار أنيقة (يوم / أسبوع / شهر / مخصص) + انتقاء تاريخ مع أيقونات تقويم.
- **زر تحديث** و**أزرار تصدير** (Excel / PDF) مع أيقونات.
- **صورة أو رسم توضيحي** (اختياري): أيقونة تقارير أو رسم بسيط يعزز الهوية البصرية.

---

### 2. لوحة KPI الرئيسية (شريط الأرقام السريعة)

- **التصميم:** بطاقات (Cards) بتصميم موحّد مع:
  - أيقونة مميزة لكل مؤشر (موظفون، حضور، مهام، تسويات، CT، مستحقات).
  - الرقم كبير وواضح مع خط عريض.
  - تسمية قصيرة أسفل الرقم.
  - لون خفيف للخلفية أو حد جانبي بلون المؤشر (أخضر للإنجاز، برتقالي للتحذير، إلخ).
- **الرسومية:** إمكانية إضافة **شريط تقدم مصغّر** (Progress bar) للمؤشرات النسبية (مثلاً نسبة الإنجاز، نسبة المطابقة في CT).
- **تفاعل:** عند المرور (hover) عرض قيمة إضافية أو وصف قصير (tooltip).

---

### 3. القسم الأول: نظرة عامة القسم والموظفون

- **رسم بياني دائري (Pie/Donut):** توزيع المهام حسب الفئة (من `categories` + تنفيذات).
- **رسم بياني أعمدة (Bar):** مقارنة الموظفين (أسماء على المحور الأفقي، عدد المهام المنفزة أو أيام الحضور على العمودي).
- **جدول ملخص الموظفين** مع تنسيق صفوف (ألوان زوجية/فردية، hover)، وأيقونة صغيرة بجانب كل موظف (أو صورة رمزية إن وُجدت).
- **صورة/أيقونة:** رسم بسيط "فريق" أو "قسم" بجانب العنوان.

---

### 4. القسم الثاني: تفصيل كل موظف

- **قائمة موظفين كروت (Cards):** كل موظف في كارت منفصل مع:
  - صورة/أفاتار أو أحرف الاسم الأولى.
  - الاسم، أيام الحضور، مهام منجزة، في الوقت، متأخرة، تغطية.
  - **شريط تقدم دائري أو خطي** لنسبة الإنجاز (مكتمل من إجمالي).
- **قابلية التوسيع (Expand):** عند النقر على الكارت يُفتح تفصيل إضافي (توزيع الفئات لهذا الموظف كرسم دائري صغير أو قائمة).
- **ألوان حسب الأداء:** تدرج من أخضر (جيد) إلى برتقالي/أحمر (يحتاج متابعة) حسب نسبة التأخر أو الإنجاز.

---

### 5. القسم الثالث: المهام والتنفيذ

- **رسم بياني:** أعمدة أو خط زمني لعدد المهام (مجدولة، مكتملة، متأخرة، معلقة) حسب التاريخ إن كانت الفترة متعددة الأيام.
- **كروت ملخص:** أربع بطاقات (مجدولة، إضافية، متأخرة، تغطية) مع أيقونات وألوان.
- **جدول المهام المتأخرة** مع تمييز بصري (لون خلفية خفيف للتحذير).
- **جدول التغطية** مع أيقونة "يد تعاون" أو شبكة بصرية صغيرة توضح من ساعد من.

---

### 6. القسم الرابع: التسويات (من gov_settlement_* فقط)

- **ملخص إحصائي كبير:** إجمالي الحركات، إجمالي المبلغ، إجمالي التسوية (من `gov_settlement_summaries` أو تجميع من `gov_settlement_details` للفترة).
- **رسم بياني أعمدة:** توزيع التسويات حسب **المصرف** (من summaries: bank_display_name مقابل sum_sttle أو movement_count).
- **رسم بياني أو جدول:** توزيع حسب **تاريخ التسوية** (sttl_date) — حركات أو مبالغ يومية.
- **جدول ملخص:** تاريخ، مصرف، عدد الحركات، مبلغ، تسوية (من summaries) مع pagination أو "عرض المزيد".
- **تفاصيل إضافية (من gov_settlement_details):** إما:
  - رسم دائري لتوزيع حسب **الوزارة** أو **المحافظة** (ministry / governorate)، أو
  - جدول عينة (أحدث N صف) مع أعمدة: تاجر، وزارة، مديرية، حركات، مبلغ تسوية.
- **بدون أي استعلام لجدول rtgs أو عرض حركات RTGS الخام.**

---

### 7. القسم الخامس: مطابقة CT

- **رسم دائري:** نسبة المطابقة مقابل غير المطابقة (من ct_records).
- **كروت KPI:** إجمالي السجلات، مطابقة، غير مطابقة، إجمالي القيمة (إن وُجد).
- **جدول السجلات** مع تمييز لوني لحالة المطابقة (أخضر/أحمر أو أيقونة صح/خطأ).

---

### 8. القسم السادس: التجار وصرف المستحقات

- **كروت:** عدد التجار، عدد الحوالات في الفترة، إجمالي المبلغ المُصرف.
- **رسم بياني (اختياري):** أعمدة أو خط للمبالغ المصرفة حسب التاريخ (من merchant_disbursements).

---

### 9. القسم السابع: الفئات

- **رسم دائري أو أعمدة أفقية:** توزيع المهام حسب الفئة (من categories + task_executions).
- **جدول تفصيلي** مع ألوان أو أشرطة تقدم مصغّرة لكل فئة (منجزة من الإجمالي).

---

### 10. القسم الثامن: مهام التسوية الحكومية

- **قائمة/جدول** مهام ذات target_settlement_date مع أيقونة تقويم وحالة التحقق.
- **تمييز بصري** للمهام المنجزة مقابل المعلقة.

---

### 11. القسم التاسع: سجل التدقيق

- **جدول زمني بصري (Timeline):** كل حدث في سطر مع تاريخ، مستخدم، إجراء، وكيان.
- **أيقونة لكل نوع إجراء** (دخول، تعديل، حذف، إلخ).

---

## التقنيات والمكتبات المقترحة للواجهة

| العنصر | المقترح |
|--------|----------|
| **رسوم بيانية** | Recharts (متوافق مع React، خفيف، دعم RTL وواجهة جاهزة) أو Chart.js مع react-chartjs-2. |
| **أشرطة تقدم** | مكوّن مخصص بـ CSS أو مكتبة مثل radix-ui progress أو shadcn/ui Progress. |
| **أيقونات** | Lucide React (موجود في المشروع) أو توسيع المجموعة. |
| **صور/رسوم توضيحية** | صور خفيفة من مشروع أو Undraw/Storyset (SVG مجانية)، أو مكوّنات SVG مخصصة للهيرو والأقسام. |
| **تدرجات وألوان** | استخدام متغيرات CSS (Design System) مع تدرجات تيل/أزرق وتمييز حالة (نجاح، تحذير، خطر). |
| **حركات وانتقالات** | Framer Motion (موجود) للظهور التدريجي والـ hover. |
| **تخطيط** | Grid و Flexbox مع breakpoints للجوال والتابلت والديسكتوب. |

---

## ترتيب التنفيذ المقترح

| المرحلة | المهمة |
|---------|--------|
| 1 | **Backend:** إزالة كل استعلامات `rtgs` من التقرير الشامل؛ الاعتماد على `gov_settlement_summaries` و `gov_settlement_details` فقط للإحصائيات وقوائم التسويات. إرجاع كائن `settlements` بدل `rtgs` (حركات، مبالغ، ملخصات، تفاصيل مجمّعة). |
| 2 | **Frontend — الهيكل:** تحديث استهلاك API (استخدام `settlements` بدل `rtgs`)، وإضافة مكتبة رسوم بيانية (Recharts). |
| 3 | **Frontend — الهيرو و KPI:** تحسين الهيرو، فلتر الفترة، وشريط KPI مع أيقونات وألوان وأشرطة تقدم حيث يناسب. |
| 4 | **Frontend — الأقسام مع رسوميات:** قسم القسم والموظفون (رسم دائري + أعمدة)، تفصيل الموظف (كروت + تقدم)، المهام (أعمدة/خط)، التسويات (أعمدة مصرف + جدول من gov)، CT (دائري)، الباقي بنفس المنطق. |
| 5 | **Frontend — صور وأيقونات:** إضافة صور/رسوم توضيحية للهيرو والأقسام، وتحسين التمييز البصري. |
| 6 | **تصدير وختام:** تصدير التقرير (Excel/PDF) إن لزم، ومراجعة أداء وتجربة المستخدم. |

---

## ملخص الضمان

- **لا استخدام لجدول `rtgs`** في صفحة التقارير أو في API التقرير الشامل.
- **مصدر بيانات التسويات:** `gov_settlement_summaries` و `gov_settlement_details` فقط (مع `import_logs` اختياري لقائمة الاستيراد فقط).
- **واجهة مثاليّة:** رسوم بيانية، أشرطة تقدم، أيقونات، تدرجات، كروت، وقصص بصرية لكل قسم.
- **تطوير اشمل:** كل قسم يُعاد تصوره كلوحة مصغّرة مع رسوميات وواجهة حديثة.

هذه الوثيقة تكون المرجع لتنفيذ التطوير المرحلي للواجهة والـ Backend.

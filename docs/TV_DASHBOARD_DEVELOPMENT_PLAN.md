# خطة التطوير الشاملة — TV Dashboard

## نظرة عامة
تهدف هذه الخطة إلى تطوير لوحة التحكم التلفزيونية لتكون أفضل مكوّن في النظام، مع توحيد التصميم والألوان وزيادة مرونة الإعدادات.

---

## المرحلة 1: كروت التسويات الحكومية

### الهدف
عرض كروت التسويات بنفس تصميم صفحة "التسويات الحكومية" في TV:
- **رأس الكارت**: تسوية [التاريخ] — [اسم المصرف] (الزراعي، الرشيد، الرافدين، إلخ)
- **تفصيل حسب تاريخ الحركة**: تاريخ الحركة، عدد الحركات، قيمة الحركات، قيمة العمولة، عمولة المحصل، قيمة التسوية
- **إجمالي التسوية**: قسم بخلفية تيل متدرجة مع كل القيم بالأبيض
- **الفوتر**: شعار النظام + زر "عرض التفصيل" (اختياري في TV)

### التنفيذ
1. إضافة شريحة جديدة `government-settlement-cards` في الخلفية تجلب بيانات RTGS المجمعة حسب تاريخ التسوية والمصرف
2. إنشاء مكوّن `GovernmentSettlementCardsCinematicSlide` في `tv-dashboard-cinematic.tsx`
3. استخدام نفس هيكل البيانات: `groups[]` مع `sttl_date`, `bank_name`, `rows[]`, `totals`

---

## المرحلة 2: إعدادات اختيار الموظفين

### الهدف
من صفحة إعدادات TV، اختيار الموظفين الذين تظهر شرائحهم فقط.

### التنفيذ
1. **الخلفية** (`tvDashboardController.js`):
   - إضافة `visibleEmployeeIds: number[]` في الإعدادات (فارغ = الكل)
   - عند بناء `employeeSlides`، تصفية حسب `visibleEmployeeIds` إذا كانت معرفة

2. **الواجهة** (`tv-settings-v2.tsx`):
   - قسم "الموظفين الظاهرين في TV"
   - قائمة اختيار متعددة (checkboxes أو multiselect) لكل الموظفين النشطين
   - إذا لم يتم اختيار أي موظف = عرض الكل

---

## المرحلة 3: نسبة التحميل أقرب للحقيقة

### المشكلة الحالية
نسبة التحميل تُحاكى بزمن ثابت (15 ثانية حتى 95%) ولا تعكس تقدّم الطلب الفعلي.

### الحلول المقترحة
1. **استخدام XMLHttpRequest مع `onprogress`**:
   - استبدال `axios.get` بـ `fetch` أو `XMLHttpRequest`
   - قراءة `event.loaded` و `event.total` — لكن JSON responses غالباً لا ترسل Content-Length بشكل صحيح من الخادم، لذا لن يعمل بدقة

2. **تقسيم الطلب إلى مراحل** (الأكثر واقعية):
   - الطلب الحالي يجلب كل البيانات دفعة واحدة
   - بدلاً من ذلك، يمكن جلب "metadata" أولاً (quick) ثم البيانات الكاملة
   - عرض نسبة بناءً على: 0% → بداية، 30% بعد 1 ثانية، 60% بعد 2 ثانية، ثم 95% حتى اكتمال الطلب

3. **تحسين المحاكاة** (الأنسب بدون تغيير API):
   - تقصير المدة الافتراضية من 15 ثانية إلى 8 ثوانٍ
   - تسريع الشريط في البداية: يصل إلى 70% في ~3 ثوانٍ ثم يتباطأ حتى 95%
   - عند اكتمال الطلب → 100% فوراً

### التنفيذ المقترح
- تطبيق التحسين (3): منحنى أسرع في البداية وأقرب لتجربة المستخدم الحقيقية

---

## المرحلة 4: توحيد ألوان TV مع النظام

### الألوان المستخدمة في النظام
من `theme-formal.css` و `index.css`:
- **Primary**: `#026174` (primary-800), `#068294` (primary-600), `#088395`
- **الخلفيات**: `#f1f5f9`, `#e2e8f0`, `#ffffff`
- **النص**: `#0f172a` (strong), `#1e293b` (text), `#475569` (muted)
- **الحدود**: `#e2e8f0`, `#cbd5e1`, `#b8dce2`

### التعديلات على TV
1. استبدال كل القيم الثابتة في `tv-dashboard-cinematic.tsx` و `tv-cinematic.css` بـ:
   - `var(--primary-600)` بدلاً من `#068294`
   - `var(--primary-800)` بدلاً من `#026174`
   - `linear-gradient(135deg, var(--primary-800), var(--primary-600))` للرؤوس والأزرار
2. التأكد من استيراد `theme-formal.css` في صفحة TV (عبر `index.css`)
3. مراجعة شرائح الحضور، التغطية، الفئات، إلخ لاستخدام نفس المتغيرات

---

## المرحلة 5: ملخص تنفيذي

| المهمة | الأولوية | الجهد | الحالة |
|--------|----------|-------|--------|
| كروت التسويات الحكومية | عالية | متوسط | ✅ مكتمل |
| إعدادات اختيار الموظفين | عالية | منخفض | ✅ مكتمل |
| نسبة التحميل أقرب للحقيقة | متوسطة | منخفض | ✅ مكتمل |
| توحيد ألوان TV | متوسطة | منخفض | ✅ مكتمل |
| استجابة كروت التسويات | متوسطة | منخفض | ✅ مكتمل |
| فلتر المصارف | متوسطة | منخفض | ✅ مكتمل |
| تنقل صفحات الكروت | متوسطة | منخفض | ✅ مكتمل |

---

## ملاحظات تقنية
- مسار TV الحالي: `/tv` → `TVDashboardCinematic`
- الخلفية: `GET /api/tv-dashboard` (عام، بدون auth)
- الإعدادات: `GET/PUT /api/tv-dashboard/settings` (يتطلب صلاحية `tv_settings`)
